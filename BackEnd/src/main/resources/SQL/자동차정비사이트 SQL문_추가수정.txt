-- ğŸš— ì°¨ëŸ‰ ì •ë¹„ ì‹œìŠ¤í…œ ë°ì´í„°ë² ì´ìŠ¤ ì‚­ì œ ë° ì¬ìƒì„±
SET FOREIGN_KEY_CHECKS=0;

DROP TABLE IF EXISTS part_prices;
DROP TABLE IF EXISTS store;
DROP TABLE IF EXISTS repair_store;
DROP TABLE IF EXISTS maintenance_records;
DROP TABLE IF EXISTS approvals;
DROP TABLE IF EXISTS store_orders;
DROP TABLE IF EXISTS notifications;
DROP TABLE IF EXISTS setup_tracks;
DROP TABLE IF EXISTS appointments;
DROP TABLE IF EXISTS vehicles;
DROP TABLE IF EXISTS user_vehicles;
DROP TABLE IF EXISTS users;
DROP TABLE IF EXISTS parts;
DROP TABLE IF EXISTS admin;
DROP TABLE IF EXISTS reviews;
DROP TABLE IF EXISTS payments;
DROP TABLE IF EXISTS ai_product;
DROP TABLE IF EXISTS user_vehicles;
DROP TABLE IF EXISTS contact_messages;


SET FOREIGN_KEY_CHECKS=1;

-- ğŸ‘¤ ì‚¬ìš©ì í…Œì´ë¸”
CREATE TABLE users (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  userId VARCHAR(50),
  name VARCHAR(100),
  email VARCHAR(100) UNIQUE NOT NULL,
  password VARCHAR(255),
  phone VARCHAR(20),
  role ENUM('USER', 'ADMIN') DEFAULT 'USER' NOT NULL,
  coOwner BOOLEAN DEFAULT FALSE,
  coOwnerName VARCHAR(100) DEFAULT NULL,
  coOwnerPhone VARCHAR(20) DEFAULT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- ğŸš˜ ì°¨ëŸ‰ í…Œì´ë¸”
CREATE TABLE vehicles (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  owner_id BIGINT,
  make VARCHAR(100) NOT NULL,
  model VARCHAR(100) NOT NULL,
  year INT NOT NULL,
  vin VARCHAR(50) UNIQUE NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  carNumber VARCHAR(20) UNIQUE NOT NULL,
  FOREIGN KEY (owner_id) REFERENCES users(id) ON DELETE CASCADE
);


-- íšŒì›ì´ ì°¨ëŸ‰ì„ ì—¬ëŸ¬ ëŒ€ ì†Œìœ í•  ìˆ˜ ìˆë„ë¡ user_vehicles í…Œì´ë¸”ì„ ë§Œë“¤ì–´ 1:N ê´€ê³„ë¥¼ í˜•ì„±í•©ë‹ˆë‹¤.
-- í•œ ì‚¬ìš©ìê°€ ì—¬ëŸ¬ ëŒ€ì˜ ì°¨ëŸ‰ì„ ë“±ë¡í•  ìˆ˜ ìˆë„ë¡ ë‹¤ëŒ€ë‹¤(M:N) ê´€ê³„ í•´ê²°
-- ì°¨ëŸ‰ì´ ì‚­ì œë˜ë©´ ìë™ìœ¼ë¡œ í•´ë‹¹ ì‚¬ìš©ìì˜ user_vehicles ë°ì´í„°ë„ ì‚­ì œë¨.
CREATE TABLE user_vehicles (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL,
    vehicle_id BIGINT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (vehicle_id) REFERENCES vehicles(id) ON DELETE CASCADE
);


-- ğŸ”© ë¶€í’ˆ í…Œì´ë¸”
CREATE TABLE parts (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  name VARCHAR(100) NOT NULL,
  category VARCHAR(100),
  price DECIMAL(10,2) NOT NULL,
  stock INT NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- ğŸª ë¶€í’ˆ íŒë§¤ì  í…Œì´ë¸”
CREATE TABLE store (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  part_id BIGINT,
  price DECIMAL(10,2) NOT NULL,
  stock INT NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (part_id) REFERENCES parts(id) ON DELETE CASCADE
);

-- ğŸ› ë¶€í’ˆ ì£¼ë¬¸ í…Œì´ë¸”
CREATE TABLE store_orders (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  user_id BIGINT,
  part_id BIGINT,
  quantity INT NOT NULL,
  order_price DECIMAL(10,2) NOT NULL,
  total_price DECIMAL(10,2) NOT NULL,
  status ENUM('PENDING', 'SHIPPED', 'DELIVERED', 'CANCELLED', 'RETURNED') NOT NULL,
  order_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
  FOREIGN KEY (part_id) REFERENCES parts(id) ON DELETE CASCADE
);

-- ğŸ›  ì •ë¹„ ì˜ˆì•½ í…Œì´ë¸”
CREATE TABLE appointments (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  user_id BIGINT,
  vehicle_id BIGINT,
  service_type VARCHAR(100) NOT NULL,
  status ENUM('ì˜ˆì•½', 'ì§„í–‰ì¤‘', 'ì™„ë£Œ') NOT NULL,
  scheduled_date TIMESTAMP NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
  FOREIGN KEY (vehicle_id) REFERENCES vehicles(id) ON DELETE CASCADE
);

-- ğŸ›  ì •ë¹„ì†Œ ì •ë³´ í…Œì´ë¸”
CREATE TABLE repair_store (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  store_id BIGINT,
  appointment_id BIGINT,
  location VARCHAR(255) NOT NULL,
  contact_info VARCHAR(100),
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (store_id) REFERENCES store(id) ON DELETE SET NULL,
  FOREIGN KEY (appointment_id) REFERENCES appointments(id) ON DELETE CASCADE
);

-- ğŸ“¢ ì•Œë¦¼ í…Œì´ë¸”
CREATE TABLE notifications (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  user_id BIGINT,
  message TEXT NOT NULL,
  status ENUM('ì½ìŒ', 'ì•ˆì½ìŒ') NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);

-- ğŸ“ˆ ë¶€í’ˆ ê°€ê²© ë¹„êµ í…Œì´ë¸”
CREATE TABLE part_prices (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  part_id BIGINT,
  store_id BIGINT,
  price DECIMAL(10,2) NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (part_id) REFERENCES parts(id) ON DELETE CASCADE,
  FOREIGN KEY (store_id) REFERENCES store(id) ON DELETE CASCADE
);

-- ğŸ¢ íŠ¸ë™ ê´€ë¦¬ í…Œì´ë¸”
CREATE TABLE setup_tracks (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  name VARCHAR(100) NOT NULL,
  description TEXT,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- ğŸ›  ê´€ë¦¬ì ìŠ¹ì¸ í…Œì´ë¸”
CREATE TABLE approvals (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  user_id BIGINT,
  approval_type ENUM('ì˜ˆì•½', 'ê²°ì œ', 'ì£¼ë¬¸ ìŠ¹ì¸', 'ë°˜í’ˆ ìŠ¹ì¸') NOT NULL,
  status ENUM('ìŠ¹ì¸', 'ê±°ì ˆ') NOT NULL,
  order_id BIGINT,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
  FOREIGN KEY (order_id) REFERENCES store_orders(id) ON DELETE CASCADE
);

-- ğŸ›  ì •ë¹„ ê¸°ë¡ í…Œì´ë¸”
CREATE TABLE maintenance_records (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  vehicle_id BIGINT,
  user_id BIGINT,
  appointment_id BIGINT,
  service_type VARCHAR(100) NOT NULL,
  description TEXT,
  service_date DATE NOT NULL,
  cost DECIMAL(10,2) NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (vehicle_id) REFERENCES vehicles(id) ON DELETE CASCADE,
  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
  FOREIGN KEY (appointment_id) REFERENCES appointments(id) ON DELETE CASCADE
);

-- ğŸ“ ë¦¬ë·° í…Œì´ë¸”
CREATE TABLE reviews (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  user_id BIGINT NOT NULL,
  content TEXT NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);

-- ğŸ’° ê²°ì œ í…Œì´ë¸”
CREATE TABLE payments (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  order_id BIGINT NOT NULL,
  amount DECIMAL(10,2) NOT NULL,
  payment_method ENUM('CARD', 'CASH', 'ONLINE') NOT NULL,
  payment_status ENUM('PENDING', 'COMPLETED', 'FAILED') NOT NULL,
  payment_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (order_id) REFERENCES store_orders(id) ON DELETE CASCADE
);

-- ğŸ¤– AI í¬ë¡¤ë§ëœ ìƒí’ˆ í…Œì´ë¸”
CREATE TABLE ai_product (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  name VARCHAR(255) NOT NULL,
  price INT NOT NULL,
  image_url VARCHAR(500),
  link VARCHAR(500),
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

);

CREATE TABLE contact_messages (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(100) NOT NULL,              -- ë¬¸ì˜ì ì´ë¦„
    car_type VARCHAR(100),                     -- ì°¨ëŸ‰ ì¢…ë¥˜ (ì˜µì…˜)
    model VARCHAR(100) NOT NULL,               -- ëª¨ë¸ëª…
    email VARCHAR(100) NOT NULL,               -- ì´ë©”ì¼ ì£¼ì†Œ
    phone_number VARCHAR(20) NOT NULL,         -- ì „í™”ë²ˆí˜¸
    message TEXT NOT NULL,                     -- ë¬¸ì˜ ë‚´ìš©
    additional_notes TEXT,                     -- ì¶”ê°€ ê¸°ì¬ì‚¬í•­ (ì˜µì…˜)
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP  -- ì‘ì„±ì¼ì‹œ
);


SET FOREIGN_KEY_CHECKS=1;
